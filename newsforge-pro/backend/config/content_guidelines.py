"""
ì¤‘ì•™ì§‘ì¤‘ì‹ ì½˜í…ì¸  ìƒì„± ê°€ì´ë“œë¼ì¸ ê´€ë¦¬
ëª¨ë“  ì½˜í…ì¸  ìƒì„± í”„ë¡¬í”„íŠ¸ì™€ ê°€ì´ë“œë¼ì¸ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬
"""

from typing import Dict, List


class ContentGuidelines:
    """ì½˜í…ì¸  ìƒì„± ê°€ì´ë“œë¼ì¸ ì¤‘ì•™ ê´€ë¦¬ í´ë˜ìŠ¤"""
    
    # ì´ëª¨ì§€ ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
    EMOJI_CATEGORIES = {
        'finance': ['ğŸ’°', 'ğŸ’µ', 'ğŸ“ˆ', 'ğŸ“Š'],
        'technology': ['ğŸš€', 'ğŸ’¡', 'ğŸ”§', 'ğŸŒŸ'],
        'policy': ['âš–ï¸', 'ğŸ“œ', 'ğŸ›ï¸', 'ğŸ”¨'],
        'conflict': ['ğŸ”¥', 'âš”ï¸', 'ğŸ¯', 'ğŸ²'],
        'cooperation': ['ğŸ¤', 'ğŸ“', 'ğŸŠ', 'ğŸŒˆ'],
        'growth': ['ğŸŒ±', 'ğŸ‰', 'ğŸ’ª', 'â­'],
        'news': ['ğŸ“°', 'âš ï¸', 'ğŸ’±', 'ğŸš—', 'â›½'],
        'tech_companies': ['ğŸ¤–', 'ğŸ’»', 'ğŸ“±', 'ğŸ¦', 'ğŸ¢'],
        'global': ['ğŸŒ', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡¯ğŸ‡µ', 'ğŸ‡°ğŸ‡·', 'ğŸ‡ªğŸ‡º']
    }
    
    # í‘œì¤€ ì˜ˆì‹œ í…œí”Œë¦¿
    EXAMPLE_TEMPLATE = """ğŸ¤ ì‹œì§„í•‘-íŠ¸ëŸ¼í”„ íšŒë‹´ ì¤€ë¹„, ì‹œê°„ ì´‰ë°•

â–¶ íšŒë‹´ ì¤€ë¹„ í˜„í™©:
â€¢ ë¯¸êµ­ê³¼ ì¤‘êµ­, ê°€ì„ ì •ìƒíšŒë‹´ ì¤€ë¹„ ì†ë„ í•„ìš”
â€¢ ë² ì´ì§• ì™¸êµë¶€ ìë¬¸ìœ„ì›, "ì‹œê°„ì´ ì´‰ë°•í•˜ë‹¤" ê°•ì¡°
â€¢ ìµœê·¼ ì–‘êµ­ ê°„ ë¬´ì—­ íœ´ì „ í•©ì˜ë¡œ ê¸ì •ì  ì‹ í˜¸

â–¶ ì–‘êµ­ ê°„ ì§„í–‰ ìƒí™©:
1. ì¤‘êµ­ í¬í† ë¥˜ ìì„ ìˆ˜ì¶œ ì¬ê°œ, ì´ì „ ìˆ˜ì¤€ì—ëŠ” ë¯¸ì¹˜ì§€ ëª»í•¨
2. ë¯¸êµ­, ì¤‘êµ­ì— ëŒ€í•œ ì¹© ì„¤ê³„ ì†Œí”„íŠ¸ì›¨ì–´ ìˆ˜ì¶œ í—ˆê°€ ìš”ê±´ ì™„í™”
3. ë¯¸êµ­, ì¤‘êµ­ìœ¼ë¡œì˜ ì—íƒ„ ìˆ˜ì¶œ ìŠ¹ì¸

â–¶ í–¥í›„ ê³„íš:
â€¢ íŠ¸ëŸ¼í”„, ì¤‘êµ­ ë°©ë¬¸ ì‹œ ê¸°ì—…ì¸ ë™í–‰ ì—¬ë¶€ ê²€í†  ì¤‘
â€¢ ì•„ì‹œì•„íƒœí‰ì–‘ê²½ì œí˜‘ë ¥ì²´(APEC) ì •ìƒíšŒì˜ ê³„ê¸° ì¤‘êµ­ ë°©ë¬¸ ê°€ëŠ¥ì„±
â€¢ ì™¸êµ ë° ë²• ì§‘í–‰ ê¸°ê´€ í¬í•¨í•œ ê´‘ë²”ìœ„í•œ ë…¼ì˜ ì±„ë„ í•„ìš”

â–¶ ì „ë¬¸ê°€ ì˜ê²¬:
â€¢ ìš°ì‹ ë³´, "íŠ¸ëŸ¼í”„ëŠ” ì¤‘êµ­ì„ ë¯¸êµ­ì˜ ì¤‘ìš”í•œ ìƒì—… íŒŒíŠ¸ë„ˆë¡œ ëª…í™•íˆ í•´ì•¼"
â€¢ "ëŒ€ë§Œ ë…ë¦½ ë°˜ëŒ€ ë° ì¤‘êµ­ì˜ í‰í™”ì  í†µì¼ ì§€ì§€ ì¬í™•ì¸ í•„ìš”"
â€¢ "íŠ¸ëŸ¼í”„ëŠ” ë¯¸êµ­ì˜ êµ­ìµì„ ìœ„í•´ ì ì ˆí•œ ë°œì–¸ì„ í•  ê²ƒ"

#ì‹œì§„í•‘ #íŠ¸ëŸ¼í”„ #ë¯¸ì¤‘ì •ìƒíšŒë‹´ #ë¬´ì—­í˜‘ìƒ #ì¤‘êµ­í¬í† ë¥˜ #ëŒ€ë§Œ #ë‚¨ì¤‘êµ­í•´"""

    @classmethod
    def get_main_prompt_template(cls) -> str:
        """ë©”ì¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë°˜í™˜"""
        return """ë‹¹ì‹ ì€ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ í•œêµ­ì–´ ìŠ¤íƒ€ì¼ì˜ ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œë¡œ ë³€í™˜í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì•„ë˜ì˜ í˜•ì‹ê³¼ ìŠ¤íƒ€ì¼ì„ ì •í™•íˆ ë”°ë¼ ë³€í™˜í•´ì£¼ì„¸ìš”.

í•„ìˆ˜ í˜•ì‹:
1. ì œëª© í˜•ì‹: ì´ëª¨ì§€ ì œëª©ë‚´ìš©
   ì˜ˆì‹œ: "ğŸ’° í¬ë¼ì¼„, ì•”í˜¸í™”í ì‹œì¥ ì ìœ ìœ¨ í™•ëŒ€ ìœ„í•´ í˜ì‹ ì ì¸ P2P ê²°ì œì•± ì¶œì‹œ"
   - ì œëª© ì‹œì‘ì— ë‚´ìš©ì„ ì˜ í‘œí˜„í•˜ëŠ” ì´ëª¨ì§€ **ì •í™•íˆ 1ê°œë§Œ** ì‚¬ìš©
   - ì´ëª¨ì§€ëŠ” ì œëª©ì˜ ì²« ë²ˆì§¸ ë¬¸ìë¡œ ìœ„ì¹˜
   - ì´ëª¨ì§€ì™€ ì œëª© ë‚´ìš© ì‚¬ì´ì— ê³µë°± í•˜ë‚˜ë§Œ ì‚¬ìš©
   - ì œëª©ì€ ë°˜ë“œì‹œ ì²« ì¤„ì— ìœ„ì¹˜
   - ì œëª© ë‹¤ìŒì—ëŠ” ë¹ˆ ì¤„ í•˜ë‚˜ ì¶”ê°€
   - ì œëª©ì€ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ë…ìì˜ ê´€ì‹¬ì„ ëŒ ìˆ˜ ìˆê²Œ ì‘ì„±
   - ë‹¨ìˆœ ì‚¬ì‹¤ ë‚˜ì—´ë³´ë‹¤ëŠ” í•µì‹¬ ê°€ì¹˜ë‚˜ ì˜ë¯¸ë¥¼ ë‹´ì•„ ì‘ì„±
   - **ì¤‘ìš”**: ì´ëª¨ì§€ëŠ” ë°˜ë“œì‹œ 1ê°œë§Œ, ì—¬ëŸ¬ ê°œ ì‚¬ìš© ê¸ˆì§€

2. ì„¹ì…˜ êµ¬ì¡°:
   - ê° ì£¼ìš” ì„¹ì…˜ì€ â–¶ë¡œ ì‹œì‘
   - ì„¹ì…˜ ì œëª©ì€ ëª…ì‚¬í˜•ìœ¼ë¡œ ëë‚¨ (ì˜ˆ: "í˜„í™©:", "ì „ë§:", "ì˜í–¥:")
   - ì„¹ì…˜ ì œëª© ë’¤ì—ëŠ” ë°˜ë“œì‹œ ì½œë¡ (:) ì‚¬ìš©

3. ê¸€ë¨¸ë¦¬ ê¸°í˜¸:
   - ì£¼ìš” ì‚¬ì‹¤/í˜„í™©ì€ â€¢ ê¸°í˜¸ ì‚¬ìš©
   - ìˆœì°¨ì  ë‚´ìš©ì´ë‚˜ ìƒì„¸ ì„¤ëª…ì€ 1. 2. 3. ë²ˆí˜¸ ì‚¬ìš©
   - ì¸ìš©êµ¬ë‚˜ ë°œì–¸ì€ ë”°ì˜´í‘œ(" ") ì‚¬ìš©

4. ë¬¸ì²´ì™€ í†¤:
   - ê°ê´€ì ì´ê³  ëª…í™•í•œ ë¬¸ì²´ ì‚¬ìš©
   - ë¬¸ì¥ì€ ê°„ê²°í•˜ê²Œ, ë˜ë„ë¡ 1-2ì¤„ ì´ë‚´ë¡œ ì‘ì„±
   - ë¬¸ì¥ì€ ë…ìê°€ ë‚´ìš©ì„ ì½ëŠ”ë° ê°„ê²°í•˜ì§€ë§Œ ì „ë‹¬í•˜ê³ ì í•˜ëŠ” ë©”ì„¸ì§€ê°€ ë¬´ì—‡ì¸ì§€ ì •í™•í•˜ê²Œ ì´í•´í•  ìˆ˜ ìˆê²Œ ì§§ì§€ë§Œ ë…¼ë¦¬ì ì´ê²Œ ì‘ì„±
   - ì „ë¬¸ ìš©ì–´ëŠ” ê°€ëŠ¥í•œ í•œê¸€ë¡œ í’€ì–´ì„œ ì„¤ëª…
   - ìˆ«ìë‚˜ í†µê³„ëŠ” ë‹¨ìœ„ì™€ í•¨ê»˜ ëª…í™•íˆ í‘œê¸°

5. êµ¬ì¡°í™”:
   - ì¤‘ìš”ë„ì™€ ì‹œê°„ ìˆœì„œë¥¼ ê³ ë ¤í•œ ì„¹ì…˜ ë°°ì¹˜
   - ê´€ë ¨ ë‚´ìš©ì€ ê°™ì€ ì„¹ì…˜ì— ëª¨ì•„ì„œ ì •ë¦¬
   - ì„¹ì…˜ ê°„ ì ì ˆí•œ ì¤„ë°”ê¿ˆìœ¼ë¡œ ê°€ë…ì„± í™•ë³´
   - ë§ˆì§€ë§‰ì—ëŠ” í–¥í›„ ì „ë§ì´ë‚˜ ê²°ë¡  í¬í•¨

6. íŠ¹ë³„ ê·œì¹™:
   - ì£¼ì‹ ì¢…ëª©ëª…ì´ ë‚˜ì˜¤ë©´ ë°˜ë“œì‹œ ì¢…ëª©ëª… ë’¤ì— $ì‹¬ë³¼ í‘œê¸°
   ì˜ˆ: í…ŒìŠ¬ë¼ $TSLA, ì• í”Œ $AAPL
   - ê´„í˜¸ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê³µë°±ìœ¼ë¡œ êµ¬ë¶„

7. ì œì™¸í•  ë‚´ìš©:
   - ê¸°ì ì†Œê°œë‚˜ í”„ë¡œí•„ ì •ë³´ (ì˜ˆ: "ì—ë§ˆ ì˜¤ì»¤ë¨¼ì€ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ...")
   - ê¸°ì ì—°ë½ì²˜ë‚˜ ì´ë©”ì¼ ì •ë³´ (ì˜ˆ: "emma.ockerman@yahooinc.comìœ¼ë¡œ ì´ë©”ì¼ì„ ë³´ë‚´ì„¸ìš”")
   - ê¸°ì ê²½ë ¥ì´ë‚˜ ì†Œì† ì–¸ë¡ ì‚¬ ì†Œê°œ
   - ê¸°ì‚¬ ë§ˆì§€ë§‰ì˜ ê¸°ì ì •ë³´ ë¸”ë¡ ì „ì²´
   - ê¸°ì ê´€ë ¨ ëª¨ë“  ê°œì¸ ì •ë³´ë‚˜ ì—°ë½ì²˜
   - í™ë³´ì„± ë©”ì‹œì§€ë‚˜ ê´‘ê³  ë¬¸êµ¬ (ì˜ˆ: "ì§€ê¸ˆ êµ¬ë…í•˜ì„¸ìš”", "ë” ë§ì€ ì •ë³´ë¥¼ ì›í•˜ì‹œë©´...")
   - ë‰´ìŠ¤ë ˆí„° êµ¬ë… ì•ˆë‚´ë‚˜ ë§ˆì¼€íŒ… ë©”ì‹œì§€
   - ì†Œì…œ ë¯¸ë””ì–´ íŒ”ë¡œìš° ìœ ë„ ë¬¸êµ¬
   - ì•± ë‹¤ìš´ë¡œë“œë‚˜ ì„œë¹„ìŠ¤ ê°€ì… ê¶Œìœ 
   - ìƒì—…ì  í™ë³´ë‚˜ ê´‘ê³ ì„± ì½˜í…ì¸ 

ì˜ˆì‹œ í˜•ì‹:
{example}

ì…ë ¥ ë°ì´í„°:
ì œëª©: {title}
ì„¤ëª…: {description}
ë³¸ë¬¸: {content}

ì œëª©ì€ ë°˜ë“œì‹œ ì²« ì¤„ì— ìœ„ì¹˜í•˜ê³ , ë‚´ìš©ì„ ì˜ í‘œí˜„í•˜ëŠ” ì´ëª¨ì§€ í•˜ë‚˜ë¥¼ ì‹œì‘ì— ë„£ì–´ì£¼ì„¸ìš”.
ì œëª©ì€ ë‹¨ìˆœíˆ ì‚¬ì‹¤ì„ ë‚˜ì—´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‚´ìš©ì˜ í•µì‹¬ ê°€ì¹˜ë‚˜ ì˜ë¯¸ë¥¼ ë‹´ì•„ ë…ìì˜ ê´€ì‹¬ì„ ëŒ ìˆ˜ ìˆê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.

ì´ëª¨ì§€ ì„ íƒ ê°€ì´ë“œ:
- ê¸ˆìœµ/íˆ¬ì ê´€ë ¨: ğŸ’° ğŸ’µ ğŸ“ˆ ğŸ“Š
- ê¸°ìˆ /í˜ì‹  ê´€ë ¨: ğŸš€ ğŸ’¡ ğŸ”§ ğŸŒŸ
- ì •ì±…/ê·œì œ ê´€ë ¨: âš–ï¸ ğŸ“œ ğŸ›ï¸ ğŸ”¨
- ê°ˆë“±/ê²½ìŸ ê´€ë ¨: ğŸ”¥ âš”ï¸ ğŸ¯ ğŸ²
- í˜‘ë ¥/ê³„ì•½ ê´€ë ¨: ğŸ¤ ğŸ“ ğŸŠ ğŸŒˆ
- ì„±ì¥/ë°œì „ ê´€ë ¨: ğŸŒ± ğŸ‰ ğŸ’ª â­
"""

    @classmethod
    def get_formatted_prompt(cls, title: str, description: str = "", content: str = "") -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        template = cls.get_main_prompt_template()
        return template.format(
            example=cls.EXAMPLE_TEMPLATE,
            title=title,
            description=description,
            content=content
        )
    
    @classmethod
    def get_emoji_for_category(cls, category: str) -> List[str]:
        """ì¹´í…Œê³ ë¦¬ë³„ ì´ëª¨ì§€ ëª©ë¡ ë°˜í™˜"""
        return cls.EMOJI_CATEGORIES.get(category, cls.EMOJI_CATEGORIES['news'])
    
    @classmethod
    def get_all_emojis(cls) -> List[str]:
        """ëª¨ë“  ì´ëª¨ì§€ ëª©ë¡ ë°˜í™˜"""
        all_emojis = []
        for emojis in cls.EMOJI_CATEGORIES.values():
            all_emojis.extend(emojis)
        return list(set(all_emojis))  # ì¤‘ë³µ ì œê±°
    
    @classmethod
    def validate_emoji_format(cls, text: str) -> bool:
        """ì´ëª¨ì§€ í¬ë§· ê²€ì¦"""
        lines = text.split('\n')
        if not lines:
            return False
        
        title_line = lines[0].strip()
        all_emojis = cls.get_all_emojis()
        
        # ì œëª©ì— ì´ëª¨ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
        emoji_count = sum(1 for emoji in all_emojis if emoji in title_line)
        
        # ì •í™•íˆ 1ê°œì˜ ì´ëª¨ì§€ê°€ ìˆê³ , ì œëª© ì‹œì‘ì— ìˆëŠ”ì§€ í™•ì¸
        if emoji_count == 1:
            for emoji in all_emojis:
                if title_line.startswith(emoji + ' '):
                    return True
        
        return False
    
    @classmethod
    def fix_emoji_format(cls, text: str) -> str:
        """ì´ëª¨ì§€ í¬ë§· ìë™ ìˆ˜ì •"""
        lines = text.split('\n')
        if not lines:
            return text
        
        title_line = lines[0].strip()
        all_emojis = cls.get_all_emojis()
        
        # ì´ëª¨ì§€ ê°œìˆ˜ í™•ì¸
        emoji_count = sum(1 for emoji in all_emojis if emoji in title_line)
        
        if emoji_count == 0:
            # ì´ëª¨ì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ëª¨ì§€ ì¶”ê°€
            formatted_title = f"ğŸ“° {title_line}"
        elif emoji_count > 1:
            # ì—¬ëŸ¬ ì´ëª¨ì§€ê°€ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ë§Œ ìœ ì§€
            first_emoji = None
            for emoji in all_emojis:
                if emoji in title_line:
                    first_emoji = emoji
                    break
            
            # ëª¨ë“  ì´ëª¨ì§€ ì œê±° í›„ ì²« ë²ˆì§¸ ì´ëª¨ì§€ë§Œ ì¶”ê°€
            clean_title = title_line
            for emoji in all_emojis:
                clean_title = clean_title.replace(emoji, '')
            
            formatted_title = f"{first_emoji} {clean_title.strip()}"
        else:
            # ì •í™•íˆ 1ê°œì˜ ì´ëª¨ì§€ê°€ ìˆëŠ” ê²½ìš°
            formatted_title = title_line
        
        # ìˆ˜ì •ëœ ì œëª©ìœ¼ë¡œ êµì²´
        lines[0] = formatted_title
        return '\n'.join(lines)
    
    @classmethod
    def format_stock_symbols(cls, text: str) -> str:
        """ì£¼ì‹ ì‹¬ë³¼ í¬ë§·íŒ…"""
        import re
        # (NASDAQ: TSLA) â†’ $TSLA í˜•íƒœë¡œ ë³€í™˜
        text = re.sub(r'\(NASDAQ:\s*([A-Z]+)\)', r' $\1', text)
        text = re.sub(r'\(NYSE:\s*([A-Z]+)\)', r' $\1', text)
        text = re.sub(r'\(([A-Z]{1,5})\)', r' $\1', text)  # ì¼ë°˜ì ì¸ ì‹¬ë³¼
        
        return text


# ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
content_guidelines = ContentGuidelines()


# í¸ì˜ í•¨ìˆ˜ë“¤
def get_content_prompt(title: str, description: str = "", content: str = "") -> str:
    """ì½˜í…ì¸  ìƒì„± í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸°"""
    return content_guidelines.get_formatted_prompt(title, description, content)


def validate_content_format(text: str) -> bool:
    """ì½˜í…ì¸  í¬ë§· ê²€ì¦"""
    return content_guidelines.validate_emoji_format(text)


def fix_content_format(text: str) -> str:
    """ì½˜í…ì¸  í¬ë§· ìë™ ìˆ˜ì •"""
    # ì´ëª¨ì§€ í¬ë§· ìˆ˜ì •
    text = content_guidelines.fix_emoji_format(text)
    
    # ì£¼ì‹ ì‹¬ë³¼ í¬ë§· ìˆ˜ì •
    text = content_guidelines.format_stock_symbols(text)
    
    return text


def get_emoji_suggestions(category: str = 'news') -> List[str]:
    """ì¹´í…Œê³ ë¦¬ë³„ ì´ëª¨ì§€ ì œì•ˆ"""
    return content_guidelines.get_emoji_for_category(category) 